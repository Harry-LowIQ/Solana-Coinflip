"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.jsonReplacers = void 0;
const web3_js_1 = require("@solana/web3.js");
const switchboard_v2_1 = require("@switchboard-xyz/switchboard-v2");
const big_js_1 = __importDefault(require("big.js"));
const bn_js_1 = __importDefault(require("bn.js"));
function big2NumberOrString(big) {
    const oldStrict = big_js_1.default.strict;
    big_js_1.default.strict = true;
    try {
        const num = big.toNumber();
        big_js_1.default.strict = oldStrict;
        return num;
    }
    catch { }
    big_js_1.default.strict = oldStrict;
    return big.toString();
}
function jsonReplacers(key, value) {
    if (typeof value === "string" || typeof value === "number") {
        return value;
    }
    // BN
    if (bn_js_1.default.isBN(value)) {
        return value.toNumber();
    }
    if (value instanceof switchboard_v2_1.SwitchboardDecimal ||
        (value &&
            typeof value === "object" &&
            "mantissa" in value &&
            "scale" in value)) {
        const swbDecimal = new switchboard_v2_1.SwitchboardDecimal(value.mantissa, value.scale);
        return big2NumberOrString(swbDecimal.toBig());
    }
    // big.js
    if (value instanceof big_js_1.default) {
        return big2NumberOrString(value);
    }
    // pubkey
    if (value instanceof web3_js_1.PublicKey) {
        return value.toBase58();
    }
    // bigint
    if (typeof value === "bigint") {
        return value.toString();
    }
    // Fall through for nested objects
    return value;
}
exports.jsonReplacers = jsonReplacers;
//# sourceMappingURL=json.js.map